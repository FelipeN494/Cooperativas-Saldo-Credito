---
pdf_document: default
author: "FelipeN"
date: "27/01/2020"
output:
  html_document: default
  pdf_document: default
title: "SCCPT2"
---
O objetivo mediato deste projeto é coletar e vizualizar dados sobre o setor das cooperativas de crédito partindo de informações obtidas no site do Banco Central do Brasil/Departamento de Promoção Da Cidadania Financeira. Já o seu objetivo imediato, limitado a este notebook é criar um gráfico de barras para mostrar as informações dos saldos de crédito das cooperativas para os clientes segundo o tipo de Pessoa (física ou jurídica). 
Inicialmente, chamou-se chamar as seguintes bibliotecas:

```{r}
library(tidyverse)
library(ggplot2)
library(reshape2)
```

Pode-se remover a linguagem científica e colocar a vírgula como separador dos decimais:

```{r}
options(OutDec = ",")
options (scipen=100)
```

É necessário baixar os dados sobre as cooperativas. Para tanto pode-se utilizar o link disponível nas referências, ou baixar diretamente no formato csv com os links:

Pessoa jurídica: http://api.bcb.gov.br/dados/serie/bcdata.sgs.25519/dados?formato=csv
Pessoa Físicasica: http://api.bcb.gov.br/dados/serie/bcdata.sgs.25518/dados?formato=csv 

Em seguida, se criou duas tabelas de dados segundo o tipo de pessoa: Física (SCCPF) e Jurídica(SCCPJ), ressaltando que os valores estão na unidade de R$(milhões):

```{r}
SCCPJ <- read.csv2("bcdata.sgs.25519.csv")
SCCPF <- read.csv2("bcdata.sgs.25518.csv")
```

Como ambas variáveis apresentam mesma data de início e fim, É possível as unir:

```{r}
SCCPT <- merge(SCCPJ,SCCPF, by=c("data"))
```

Optou-se por renomear as últimas colunas e em transformar os valores em "numeric":

```{r}
SCCPT <- rename(SCCPT, Valor.PJ = valor.x, Valor.PF = valor.y, Data = data)
SCCPT[,2] <- as.numeric(SCCPT[,2])
SCCPT[,3] <- as.numeric(SCCPT[,3])
```

Em seguida, se criou uma nova variável e um gráfico de barras para essas informações, mas sem alterar as variáveis anteriores:

```{r}
SCCPT2 <- melt(SCCPT,id.vars = "Data")
SCCPT2$Data <- as.Date(SCCPT2$Data, "%d/%m/%Y")
SCCPT2$Data <- as.numeric(format(SCCPT2$Data,"%Y"))
ggplot(SCCPT2, mapping=aes(x=SCCPT2$Data, y=SCCPT2$value)) + 
  geom_bar(mapping=aes(fill=SCCPT2$variable), stat="identity", position='dodge') + 
  scale_y_continuous(limits=c(0,100000), expand=c(0,0)) +
  scale_x_discrete(limits=c(2012,2013,2014,2015,2016,2017,2018), expand=c(0,0)) +
  theme(text=element_text(size=10)) +
  labs(title="Saldo de Crédito das Cooperativas para PJ e PF", x ="Ano", 
       y = "Valor da Compra aproximado em R$(milhões)", fill="Legenda") + 
  geom_text(aes(label=SCCPT2$value, group=SCCPT2$variable), 
            position = position_dodge(width = 0.95), vjust=-0.5, size=2.5) +
  scale_fill_brewer(palette="Dark2") 
```
REFERÊNCIAS
Pacotes usados:

Hadley Wickham (2007). Reshaping Data with the reshape Package. Journal of
Statistical Software, 21(12), 1-20. URL http://www.jstatsoft.org/v21/i12/.
  
H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York,
2016.

Hadley Wickham (2017). tidyverse: Easily Install and Load the 'Tidyverse'. R package
version 1.2.1. https://CRAN.R-project.org/package=tidyverse.

Linguagem R:
R Core Team (2019). R: A language and environment for statistical computing. R
Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.
