---
title: "SCCTF"
output: html_notebook
---
Este arquivo unifica os códigos produzidos nesse projeto de visualização de dados sobre o saldo de crédito das cooperativas financeiras segundo diversas caracaterísticas. Estas são: o tipo de cliente, isto é, se Pessoa Física ou Jurídica (PF e PJ respectivamente); o valor do crédito; e a região.   

Antes de começar, aviso ser possível remover a linguagem científica e colocar a vírgula como separador dos decimais:

```{r}
options (OutDec = ",")
options (scipen=100)
```

Inicialmente, chama-se as bibliotecas:

```{r}
library(tidyverse)
library(ggplot2)
library(reshape2)
```

Em seguida, se criou duas tabelas de dados segundo as diversas variáveis conforme o código abaixo (ressaltando que os valores do saldo de crédito estão em R$ milhões):

```{r}
#"Saldo de crédito das cooperativas para clientes pessoa física (total)".
SCCPF <- read.csv2("bcdata.sgs.25518.csv")
#"Saldo de crédito das cooperativas para clientes pessoa juridica (total)".
SCCPJ <- read.csv2("bcdata.sgs.25519.csv")
#"Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - menor que R$ 1 mil."
C1M <- read.csv2("bcdata.sgs.25536.csv")
# "Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - de R$ 1 mil a R$ 5 mil."
C51M <- read.csv2("bcdata.sgs.25537.csv")
# "Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - de R$ 5 mil a R$ 10 mil."
C510M <- read.csv2("bcdata.sgs.25538.csv")
#"Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - acima de R$ 10 mil."
C10M <- read.csv2("bcdata.sgs.25539.csv")
#"Saldo de crédito das cooperativas para clientes pessoa física por região - Centro-Oeste."	
CO <- read.csv2("bcdata.sgs.25540.csv")
#"Saldo de crédito das cooperativas para clientes pessoa física por região - Nordeste."
NE <- read.csv2("bcdata.sgs.25541.csv")
#"Saldo de crédito das cooperativas para clientes pessoa física por região - Norte."	
NO <- read.csv2("bcdata.sgs.25542.csv")
#"Saldo de crédito das cooperativas para clientes pessoa física por região - Sudeste."
SE <- read.csv2("bcdata.sgs.25543.csv")
#"Saldo de crédito das cooperativas para clientes pessoa física por região - Sul."
S <- read.csv2("bcdata.sgs.25544.csv")
```

Juntando todas as variáveis acima em uma só (que chamarei de SCCT - representando o Saldo de Crédito das Cooperativas Total)

```{r}
#Unificando para o tipo de pessoa:
SCCT <- merge(SCCPJ,SCCPF, by=c("data"))
SCCT <- rename(SCCT, Valor.PJ = valor.x, Valor.PF = valor.y, Data = data)
SCCT[,2] <- as.numeric(SCCT[,2])
SCCT[,3] <- as.numeric(SCCT[,3])
#Unificando para o valor:
CF1 <- merge(C1M, C51M, by=c("data")) 
CF2 <- merge(C510M, C10M, by=c("data"))
CF3 <- merge(CF1, CF2, by=c("data"))
colnames(CF3) <- c("Data", "1", "1-5", "5-10", "10")
SCCT <- merge(SCCT, CF3, by=c("Data")) 
SCCT[,4] <- as.numeric(SCCT[,4])
SCCT[,5] <- as.numeric(SCCT[,5])
SCCT[,6] <- as.numeric(SCCT[,6])
SCCT[,7] <- as.numeric(SCCT[,7])
#Unificando para a região:
RE1 <- merge(CO, NE, by=c("data")) 
RE2 <- merge(NO, S, by=c("data"))
RE3 <- merge(SE, RE1, by=c("data"))
RE4 <- merge(RE2, RE3, by=c("data"))
colnames(RE4) <- c("Data", "NO", "S", "SE", "CO", "NE")
SCCT <- merge(SCCT, RE4, by=c("Data")) 
SCCT[,8] <- as.numeric(SCCT[,8])
SCCT[,9] <- as.numeric(SCCT[,9])
SCCT[,10] <- as.numeric(SCCT[,10])
SCCT[,11] <- as.numeric(SCCT[,11])
SCCT[,12] <- as.numeric(SCCT[,12])
```

Para a geração dos gráficos foram criadas versões distintas da váriavel SCCT visando a manipulação dos dados sem alterar a variável originária. 
Primeiramente, criou-se um gráfico de barras para analisar o saldo de crédito segundo o tipo de pessoa. Conforme gráfico abaixo, pode-se notar que o saldo de crédito para pessoas físicas cresceu de maneira constante no período entre 2012-2018; o mesmo parece não ter ocorrido com o saldo para clientes pessoa jurídica, o qual cresce até 2016, cai em 2017 e volta a subir em 2018, mas sem recuperar completamente os valores de 2016:

```{r}
SCCT2 <- melt(SCCT[,1:3],id.vars = "Data")
SCCT2$Data <- as.Date(SCCT2$Data, "%d/%m/%Y")
SCCT2$Data <- as.numeric(format(SCCT2$Data,"%Y"))
ggplot(SCCT2, mapping=aes(x=SCCT2$Data, y=SCCT2$value)) + 
  geom_bar(mapping=aes(fill=SCCT2$variable), stat="identity", position='dodge') + 
  scale_y_continuous(limits=c(0,100000), expand=c(0,0)) +
  scale_x_discrete(limits=c(2012,2013,2014,2015,2016,2017,2018), expand=c(0.05,0)) +
  theme(text=element_text(size=10)) +
  labs(title="Saldo de Crédito das Cooperativas para PJ e PF", x ="Ano", 
       y = "Valor aproximado em R$(milhões)", caption="Fonte: BCB/Depef", fill="Legenda") + 
  geom_text(aes(label=SCCT2$value, group=SCCT2$variable), 
            position = position_dodge(width = 0.95), vjust=-0.5, size=2.5) +
  scale_fill_brewer(palette="Dark2") 
```

Na avaliação do saldo de crédito das cooperativas para clientes pessoa física segundo o valor de crédito, criou-se gráficos de boxplot e de linhas. Com isso, nota-se uma variação dos valores do saldo de crédito (em R$ milhões) no período entre 2012-2018, com tendência crescente  em todos os valores de crédito (em R$ milhares), isso fica ainda mais claro quando retiramos os saldos nos valores de R$ 10 mil da visualização gráfica (permitindo observar mais detalhadamente os demais). 

```{r}
# Boxplot do saldo de crédito das cooperativas para PF segundo o valor do crédito.
ggplot(stack(SCCT[,4:7]), mapping=aes(x=ind,y=values)) +
  geom_boxplot(fill="springgreen3") +
  theme(panel.background = element_rect(fill = 'gray76')) +
  labs(title="Saldo de Crédito das Cooperativas para PF segundo o valor do crédito", subtitle = "Período entre 2012-2018", caption="Fonte: BCB/Depef", x = "Valor do Crédito em R$ milhares", y = "Saldo em R$ milhões", fill="Legenda") + 
  scale_y_continuous(limits=c(0,32000), expand=c(0,0)) +
  theme(text=element_text(size=10)) 
# Boxplot do saldo de crédito das cooperativas para PF segundo o valor do crédito, excluindo valores acima de R$ 10 mil.
ggplot(stack(SCCT[,4:6]), mapping=aes(x=ind,y=values),) +
  geom_boxplot(fill="springgreen3") +
  theme(panel.background = element_rect(fill = 'gray76')) +
  labs(title="Saldo do Crédito das Cooperativas para PF segundo o valor do crédito", subtitle = "Período entre 2012-2018", caption="Fonte: BCB/Depef", x ="Valor do Crédito em R$ milhares", y = "Saldo em R$ milhões", fill="Legenda") + 
  scale_y_continuous(limits=c(0,11000), expand=c(0,0)) +
  theme(text=element_text(size=10)) 
# Gráfico de linhas do saldo de crédito das cooperativas para PF segundo o valor do crédito.
SCCT3 <- SCCT
SCCT3$Data <- as.Date(SCCT3$Data, "%d/%m/%Y")
SCCT3$Data <- as.numeric(format(SCCT3$Data,"%Y"))
SCCT3$Data <- round(SCCT3$Data, digits=0)
SCCT3 <- cbind(SCCT3[,1], stack(SCCT3[,4:7]))
ggplot(data=SCCT3, aes(x = SCCT3[, 1], y = values)) +
  geom_line(aes(linetype=ind, color=ind, group = ind)) +
  geom_point() + 
  scale_y_continuous(limits=c(0,31000), expand=c(0,0)) +
  labs(title="Saldo do Crédito das Cooperativas para PF segundo o valor do crédito", x ="Ano", caption="Fonte: BCB/Depef",
       y = "Saldo em R$ milhões", linetype ="Tipo de Linha", color="Cor") +
  scale_x_discrete(limits=c(2012,2013,2014,2015,2016,2017,2018), expand=c(0.01,0.01)) +
  theme(text=element_text(size=10)) 
# Gráfico de linhas do saldo de crédito das cooperativas para PF segundo o valor do crédito, excluindo valores acima de R$ 10 mil.
SCCT3 <- SCCT[,-c(7)]
SCCT3$Data <- as.Date(SCCT3$Data, "%d/%m/%Y")
SCCT3$Data <- as.numeric(format(SCCT3$Data,"%Y"))
SCCT3$Data <- round(SCCT3$Data, digits=0)
SCCT3 <- cbind(SCCT3[,1], stack(SCCT3[,4:6]))
ggplot(data=SCCT3, aes(x = SCCT3[, 1], y = values)) +
  geom_line(aes(linetype=ind, color=ind, group = ind)) +
  geom_point() + 
  scale_y_continuous(limits=c(0,7500), expand=c(0,0)) +
  labs(title="Saldo do Crédito das Cooperativas para PF segundo o valor do crédito", x ="Ano", caption="Fonte: BCB/Depef", y = "Saldo em R$ milhões", linetype ="Tipo de Linha", color="Cor") +
  scale_x_discrete(limits=c(2012,2013,2014,2015,2016,2017,2018), expand=c(0.01,0.01)) +
  theme(text=element_text(size=10)) 
```

Por fim, cria-se o gráfico de barras para avaliar o saldo de crédito das cooperativas financeiras para clientes pessoas físicas por região. Nota-se crescimento do valor do saldo em todas as regiões no período entre 2012-2018, principalmente na região Sul. Todavia, ao avaliar o crescimento proporcional entre 2012-2018, nota-se que o Norte apresentou crescimento mais acelerado, com valores 4 vezes maiores em 2018 comparados com 2012:

```{r}
# Gráfico de barras do valor total do saldo de crédito para pessoas físicas.
SCCT4 <- SCCT
SCCT4$Data <- as.Date(SCCT4$Data, "%d/%m/%Y")
SCCT4$Data <- as.numeric(format(SCCT4$Data,"%Y"))
SCCT4$Data <- round(SCCT4$Data, digits=0)
SCCT4 <- cbind(SCCT4[,1], stack(SCCT4[,8:12]))
colnames(SCCT4) <- c("Ano", "Saldo de Crédito", "Regiao")
SCCT4$Ano <- as.factor(SCCT4$Ano)
ggplot(data= SCCT4, mapping=aes(x = Regiao, y = `Saldo de Crédito`, group=Ano, fill=Ano)) + 
    geom_bar(stat="identity", position='dodge') +
    theme(text=element_text(size=10)) +
    scale_fill_brewer(palette="Greens") +
    labs(title="Saldo de Crédito das Cooperativas Financeiras para PF por região", subtitle= "Em R$ milhões", x = "Região", y = "Saldo", fill="Ano", caption="Fonte: BCB/Depef") 
# Crescimento proporcional.
barplot(height= as.matrix(SCCT[7,8:12]/SCCT[1,8:12]),
        col= "seagreen3",
        main="Proporção do Saldo de Crédito para PF por região", sub = "Fonte: BCB/Depef", 
        cex.sub = 0.75,
        xlab="Região", ylab="Proporção",
        ylim = c(0,5))
```

Conclusões: podemos concluir que no período entre 2012 e 2018 houve crescimento constante do saldo de crédito das cooperativas para pessoas físicas. No que concerne ao valor total do saldo de crédito para estas, o principal componente deste são créditos acima de R$ 10 mil. Ainda, nota-se que a região que apresenta valores mais altos nesse saldo é o Sul, apesar do Norte ter apresentado crescimento mais vertiginoso, em termos proporcionais, no período.

Referências:
BANCO CENTRAL DO BRASIL/DEPEF. Saldo de crédito das cooperativas para clientes pessoa física - total. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25518-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica----total>. Acesso em: 26 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa juridica - total.Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25519-saldo-de-credito-das-cooperativas-para-clientes-pessoa-juridica----total>. Acesso em: 26 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF. Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - menor que R$ 1 mil. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25536-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-faixa-de-valor---menor-que->. Acesso em: 28 jan 2020.

BANCO CENTRAL DO BRASIL/DEPEF. Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - de R$ 1 mil a R$ 5 mil.
Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25537-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-faixa-de-valor---de-rs-1-mi>. Acesso em: 28 jan 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - de R$ 5 mil a R$ 10 mil. 
 Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25538-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-faixa-de-valor---de-rs-5-mi>. Acesso em: 28 jan 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - acima de R$ 10 mil. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25539-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-faixa-de-valor---acima-de-r>. Acesso em: 28 jan 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por região - Sul. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25544-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-regiao---sul>. Acesso em: 30 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por região - Sudeste. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25543-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-regiao---sudeste>. Acesso em: 30 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por região - Norte. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25542-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-regiao---norte>. Acesso em: 30 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por região - Nordeste. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25541-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-regiao---nordeste>. Acesso em: 30 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por região - Centro-Oeste. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25540-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-regiao---centro-oeste>. Acesso em: 30 jan. 2020.
 
Pacotes usados:

Hadley Wickham (2007). Reshaping Data with the reshape Package. Journal of
Statistical Software, 21(12), 1-20. URL http://www.jstatsoft.org/v21/i12/.
  
H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York,
2016.

Hadley Wickham (2017). tidyverse: Easily Install and Load the 'Tidyverse'. R package
version 1.2.1. https://CRAN.R-project.org/package=tidyverse.

Linguagem R:
R Core Team (2019). R: A language and environment for statistical computing. R
Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.