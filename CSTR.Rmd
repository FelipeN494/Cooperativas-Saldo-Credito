---
title: "CSTR"
author: "FelipeN"
date: "30/01/2020"
output: html_document
---

Inicialmente, baixam-se as bibliotecas:

```{r}
library(tidyverse)
library(ggplot2)
library(reshape2)
```

Em seguida, atribuem-se os dados à variáves segundo a região:

```{r}
#Saldo de crédito das cooperativas para clientes pessoa física por região - Centro-Oeste	
CO <- read.csv2("bcdata.sgs.25540.csv")
#Saldo de crédito das cooperativas para clientes pessoa física por região - Nordeste	
NE <- read.csv2("bcdata.sgs.25541.csv")
#Saldo de crédito das cooperativas para clientes pessoa física por região - Norte	
NO <- read.csv2("bcdata.sgs.25542.csv")
#Saldo de crédito das cooperativas para clientes pessoa física por região - Sudeste
SE <- read.csv2("bcdata.sgs.25543.csv")
#Saldo de crédito das cooperativas para clientes pessoa física por região - Sul
S <- read.csv2("bcdata.sgs.25544.csv")

```

Para se unificar com os valores dos outros dois documentos Rmarkdown, para garantir que a variável SCCPT esteja completa,  pode-se executar o código: 
```{r}
SCCPJ <- read.csv2("bcdata.sgs.25519.csv")
SCCPF <- read.csv2("bcdata.sgs.25518.csv")
SCCPT <- merge(SCCPJ,SCCPF, by=c("data"))
SCCPT <- rename(SCCPT, Valor.PJ = valor.x, Valor.PF = valor.y, Data = data)
SCCPT[,2] <- as.numeric(SCCPT[,2])
SCCPT[,3] <- as.numeric(SCCPT[,3])
C1M <- read.csv2("bcdata.sgs.25536.csv")
C51M <- read.csv2("bcdata.sgs.25537.csv")
C510M <- read.csv2("bcdata.sgs.25538.csv")
C10M <- read.csv2("bcdata.sgs.25539.csv")
CF1 <- merge(C1M, C51M, by=c("data")) 
CF2 <- merge(C510M, C10M, by=c("data"))
CF3 <- merge(CF1, CF2, by=c("data"))
colnames(CF3) <- c("Data", "1", "1-5", "5-10", "10")
SCCPT <- merge(SCCPT, CF3, by=c("Data")) 
SCCPT[,4] <- as.numeric(SCCPT[,4])
SCCPT[,5] <- as.numeric(SCCPT[,5])
SCCPT[,6] <- as.numeric(SCCPT[,6])
SCCPT[,7] <- as.numeric(SCCPT[,7])

```

Agora juntando-se as variáveis:

```{r}
RE1 <- merge(CO, NE, by=c("data")) 
RE2 <- merge(NO, S, by=c("data"))
RE3 <- merge(SE, RE1, by=c("data"))
RE4 <- merge(RE2, RE3, by=c("data"))
colnames(RE4) <- c("Data", "NO", "S", "SE", "CO", "NE")
SCCPT <- merge(SCCPT, RE4, by=c("Data")) 
SCCPT[,8] <- as.numeric(SCCPT[,8])
SCCPT[,9] <- as.numeric(SCCPT[,9])
SCCPT[,10] <- as.numeric(SCCPT[,10])
SCCPT[,11] <- as.numeric(SCCPT[,11])
SCCPT[,12] <- as.numeric(SCCPT[,12])

```

visualizando a tabela SCCPT temos:
```{r}
SCCPT
```

Para evitar modificar a variável SCCPT, criou-se uma variável para ser usada na geração do gráfico:

```{r}
SCCPT4 <- SCCPT
SCCPT4$Data <- as.Date(SCCPT4$Data, "%d/%m/%Y")
SCCPT4$Data <- as.numeric(format(SCCPT4$Data,"%Y"))
SCCPT4$Data <- round(SCCPT4$Data, digits=0)
SCCPT4 <- cbind(SCCPT4[,1], stack(SCCPT4[,8:12]))
colnames(SCCPT4) <- c("Ano", "Saldo de Crédito", "Regiao")
SCCPT4$Ano <- as.factor(SCCPT4$Ano)
```

Finalmente, cria-se o gráfico:

```{r}
ggplot(data= SCCPT4, mapping=aes(x = Regiao, y = `Saldo de Crédito`, group=Ano, fill=Ano)) + 
    geom_bar(stat="identity", position='dodge') +
    theme(text=element_text(size=10)) +
    scale_fill_brewer(palette="Greens") +
    labs(title="Saldo de Crédito das Cooperativas Financeiras por Região", subtitle= "Em R$ milhões", x = "Região", y = "Saldo", fill="Ano", caption="Fonte: BCB/Depef") 
```

A partir do gráfico podemos notar um crescimento significativo do saldo de crédito em todas as regiões do país. Ainda, nota-se que os maiores valores no saldo de crédito estão na região Sul. Os números absolutos não significam, necessariamente, os maiores avanços em termos relativos nesse período por região (isto é, em quantas vezes o valor aumentou na região). 

Nesse sentido, podemos obter visualizar o aumento entre 2018/2012 dividindo-se os valores de cada região nesse período:

```{r}
barplot(height= as.matrix(SCCPT[7,8:12]/SCCPT[1,8:12]),
        col= "seagreen3",
        main="Proporção Saldo de Crédito por Região", sub = "Fonte: BCB/Depef", 
        cex.sub = 0.75,
        xlab="Região", ylab="Proporção",
        ylim = c(0,5))
```

Partindo do gráfico acima podemos afirmar que a região do Nordeste apresenta o maior crescimento no saldo de crédito das cooperativas financeiras no período de 2012-2018 (em 2018, o referido valor era quatro vezes maior que em 2012).

Referências:
BANCO CENTRAL DO BRASIL/DEPEF. Saldo de crédito das cooperativas para clientes pessoa física - total. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25518-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica----total>. Acesso em: 26 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa juridica - total.Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25519-saldo-de-credito-das-cooperativas-para-clientes-pessoa-juridica----total>. Acesso em: 26 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF. Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - menor que R$ 1 mil. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25536-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-faixa-de-valor---menor-que->. Acesso em: 28 jan 2020.

BANCO CENTRAL DO BRASIL/DEPEF. Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - de R$ 1 mil a R$ 5 mil.
Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25537-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-faixa-de-valor---de-rs-1-mi>. Acesso em: 28 jan 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - de R$ 5 mil a R$ 10 mil. 
 Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25538-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-faixa-de-valor---de-rs-5-mi>. Acesso em: 28 jan 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - acima de R$ 10 mil. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25539-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-faixa-de-valor---acima-de-r>. Acesso em: 28 jan 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por região - Sul. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25544-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-regiao---sul>. Acesso em: 30 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por região - Sudeste. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25543-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-regiao---sudeste>. Acesso em: 30 jan. 2020.


BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por região - Norte. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25542-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-regiao---norte>. Acesso em: 30 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por região - Nordeste.Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25541-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-regiao---nordeste>. Acesso em: 30 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por região - Centro-Oeste. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25540-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-regiao---centro-oeste>. Acesso em: 30 jan. 2020.
 
Pacotes usados:

Hadley Wickham (2007). Reshaping Data with the reshape Package. Journal of
Statistical Software, 21(12), 1-20. URL http://www.jstatsoft.org/v21/i12/.
  
H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York,
2016.

Hadley Wickham (2017). tidyverse: Easily Install and Load the 'Tidyverse'. R package
version 1.2.1. https://CRAN.R-project.org/package=tidyverse.

Linguagem R:
R Core Team (2019). R: A language and environment for statistical computing. R
Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.