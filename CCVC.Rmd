---
title: "Código sobre as cooperativas segundo o valor do crédito para pessoa física em milhões"
output: html_notebook
---
Esse notebook busca visualizar o Saldo de crédito cooperativas para pessoas físicas segundo o valor (em R$ milhões).
Inicialmente, baixam-se as bibliotecas:

```{r}
library(tidyverse)
library(ggplot2)
library(reshape2)
```

Depois, baixam-se os arquivos contendo os valores:

```{r}
# Baixando para valores de até R$ 1.000
C1M <- read.csv2("bcdata.sgs.25536.csv")
# Baixando para valores entre R$ 1.000 e R$ 5.000
C51M <- read.csv2("bcdata.sgs.25537.csv")
# Baixando para valores entre R$ 5.000 e R$ 10.000
C510M <- read.csv2("bcdata.sgs.25538.csv")
# Baixando para valores acima de R$ 10.000
C10M <- read.csv2("bcdata.sgs.25539.csv")
```

Para se unificar os valores, junta-se as séries temporais com a variável já criada: SCCPT. Se necessário, pode-se recriar a variável com o código infra:

```{r}
SCCPJ <- read.csv2("bcdata.sgs.25519.csv")
SCCPF <- read.csv2("bcdata.sgs.25518.csv")
SCCPT <- merge(SCCPJ,SCCPF, by=c("data"))
SCCPT <- rename(SCCPT, Valor.PJ = valor.x, Valor.PF = valor.y, Data = data)
SCCPT[,2] <- as.numeric(SCCPT[,2])
SCCPT[,3] <- as.numeric(SCCPT[,3])
```

Agora juntando-se as variáveis:

```{r}
CF1 <- merge(C1M, C51M, by=c("data")) 
CF2 <- merge(C510M, C10M, by=c("data"))
CF3 <- merge(CF1, CF2, by=c("data"))
colnames(CF3) <- c("Data", "1", "1-5", "5-10", "10")
SCCPT <- merge(SCCPT, CF3, by=c("Data")) 
SCCPT[,4] <- as.numeric(SCCPT[,4])
SCCPT[,5] <- as.numeric(SCCPT[,5])
SCCPT[,6] <- as.numeric(SCCPT[,6])
SCCPT[,7] <- as.numeric(SCCPT[,7])
```

Por fim, pode-se criar um gráfico de boxplot, o qual indica que o valor do saldo (em RS milhões) segue de maneira próxima o valor do crédio (em RS milhares) nesse período entre 2012 e 2018, todavia, isso se aplica menos aos créditos acima de R$ 10.000, os quais apresentam variação maior.

```{r}
ggplot(stack(SCCPT[,4:7]), mapping=aes(x=ind,y=values),) +
  geom_boxplot(fill="springgreen3") +
  theme(panel.background = element_rect(fill = 'gray76')) +
  labs(title="Saldo Crédito das Cooperativas para PF segundo o valor do crédito", subtitle = "Período entre 2012-2018", x ="Valor do Crédito em R$ milhares de reais", caption="Fonte: BCB/Depef", y = "Saldo em R$ milhões", fill="Legenda") + 
  scale_y_continuous(limits=c(0,32000), expand=c(0,0)) +
  theme(text=element_text(size=15)) 
```

Pode-se também excluir os valores de crédito de mais de R$ 10.000 para melhor visualizar a variação no saldo em se tratando de créditos abaixo desse valor. Ainda assim, nota-se pouca variação nessas faixas de valores.

```{r}
ggplot(stack(SCCPT[,4:6]), mapping=aes(x=ind,y=values),) +
  geom_boxplot(fill="springgreen3") +
  theme(panel.background = element_rect(fill = 'gray76')) +
  labs(title="Saldo de Crédito das Cooperativas para PF segundo o valor do crédito",subtitle = "Período entre 2012-2018", caption="Fonte: BCB/Depef", x ="Valor do Crédito em R$ milhares de reais", 
       y = "Saldo em R$ milhões", fill="Legenda") + 
  scale_y_continuous(limits=c(0,11000), expand=c(0,0)) +
  theme(text=element_text(size=15)) 
```

Inserindo as observações, nota-se como o valor do saldo permanece anualmente constante para a maioria dos créditos, salvo para aqueles acima de R$ 10.000.

```{r}
ggplot(stack(SCCPT[,4:7]), mapping=aes(x=ind,y=values)) +
  geom_boxplot(fill="springgreen3") +
  theme(panel.background = element_rect(fill = 'gray76')) +
  geom_jitter(color="Red", size=1.2, alpha=1)  +
  labs(title="Saldo de Crédito das Cooperativas para PF segundo o valor do crédito", subtitle = "Período entre 2012-2018", caption="Fonte: BCB/Depef", x = "Valor do Crédito em R$ milhares de reais", 
       y = "Saldo em R$ milhões", fill="Legenda") + 
  scale_y_continuous(limits=c(0,32000), expand=c(0,0)) +
  theme(text=element_text(size=15)) 
```

Todavia, essa impressão se deve ao fato da inclusão de valores de crédito superiores a R$ 10.000 no gráfico de boxplot. Ao observar o gráfico sem os referidos valores, nota-se uma forte variação sobre os valores do saldo em todas as categorias de crédito:

```{r}
ggplot(stack(SCCPT[,4:6]), mapping=aes(x=ind,y=values),) +
  geom_boxplot(fill="springgreen3") +
  theme(panel.background = element_rect(fill = 'gray76')) +
  geom_jitter(color="Red", size=1.2, alpha=1)  +
  labs(title="Saldo do Crédito das Cooperativas para PF segundo o valor do crédito", subtitle = "Período entre 2012-2018", caption="Fonte: BCB/Depef", x ="Valor do Crédito em R$ milhares de reais", y = "Saldo em R$ milhões", fill="Legenda") + 
  scale_y_continuous(limits=c(0,11000), expand=c(0,0)) +
  theme(text=element_text(size=15)) 
```

Por fim, pode-se acompanhar melhor a evolução do saldo segundo o tipo de valor no gráfico de linhas:

```{r}
SCCPT3 <- SCCPT
SCCPT3$Data <- as.Date(SCCPT3$Data, "%d/%m/%Y")
SCCPT3$Data <- as.numeric(format(SCCPT3$Data,"%Y"))
SCCPT3$Data <- round(SCCPT3$Data, digits=0)
SCCPT3 <- cbind(SCCPT3[,1], stack(SCCPT3[,4:7]))
ggplot(data=SCCPT3, aes(x = SCCPT3[, 1], y = values)) +
  geom_line(aes(linetype=ind, color=ind, group = ind)) +
  geom_point() + 
  scale_y_continuous(limits=c(0,31000), expand=c(0,0)) +
  labs(title="Saldo do Crédito das Cooperativas para PF segundo o valor do crédito", x ="Ano", caption="Fonte: BCB/Depef",
       y = "Saldo em R$ milhões", linetype ="Tipo de Linha", color="Cor") +
  scale_x_discrete(limits=c(2012,2013,2014,2015,2016,2017,2018), expand=c(0.01,0.01)) +
  theme(text=element_text(size=12)) 
```

Excluindo-se os valores acima de R$ 10.000, temos:

```{r}
SCCPT3 <- SCCPT[,-c(7)]
SCCPT3$Data <- as.Date(SCCPT3$Data, "%d/%m/%Y")
SCCPT3$Data <- as.numeric(format(SCCPT3$Data,"%Y"))
SCCPT3$Data <- round(SCCPT3$Data, digits=0)
SCCPT3 <- cbind(SCCPT3[,1], stack(SCCPT3[,4:6]))
ggplot(data=SCCPT3, aes(x = SCCPT3[, 1], y = values)) +
  geom_line(aes(linetype=ind, color=ind, group = ind)) +
  geom_point() + 
  scale_y_continuous(limits=c(0,8000), expand=c(0,0)) +
  labs(title="Saldo do Crédito das Cooperativas para PF segundo o valor do crédito", x ="Ano", caption="Fonte: BCB/Depef", y = "Saldo em R$ milhões", linetype ="Tipo de Linha", color="Cor") +
  scale_x_discrete(limits=c(2012,2013,2014,2015,2016,2017,2018), expand=c(0.01,0.01)) +
  theme(text=element_text(size=12)) 
```


Base de Dados:
BANCO CENTRAL DO BRASIL/DEPEF. Saldo de crédito das cooperativas para clientes pessoa física - total. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25518-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica----total>. Acesso em: 26 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa juridica - total.Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25519-saldo-de-credito-das-cooperativas-para-clientes-pessoa-juridica----total>. Acesso em 26 jan. 2020.

BANCO CENTRAL DO BRASIL/DEPEF. Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - menor que R$ 1 mil. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25536-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-faixa-de-valor---menor-que->. Acesso em 28 jan 2020.

BANCO CENTRAL DO BRASIL/DEPEF. Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - de R$ 1 mil a R$ 5 mil.
Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25537-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-faixa-de-valor---de-rs-1-mi>. Acesso em: 28 jan 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - de R$ 5 mil a R$ 10 mil. 
 Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25538-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-faixa-de-valor---de-rs-5-mi>. Acesso em 28 jan 2020.

BANCO CENTRAL DO BRASIL/DEPEF.Saldo de crédito das cooperativas para clientes pessoa física por faixa de valor - acima de R$ 10 mil. Disponível em: <https://dadosabertos.bcb.gov.br/dataset/25539-saldo-de-credito-das-cooperativas-para-clientes-pessoa-fisica-por-faixa-de-valor---acima-de-r>.


Pacotes usados:

Hadley Wickham (2007). Reshaping Data with the reshape Package. Journal of
Statistical Software, 21(12), 1-20. URL http://www.jstatsoft.org/v21/i12/.
  
H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York,
2016.

Hadley Wickham (2017). tidyverse: Easily Install and Load the 'Tidyverse'. R package
version 1.2.1. https://CRAN.R-project.org/package=tidyverse.

Linguagem R:
R Core Team (2019). R: A language and environment for statistical computing. R
Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.
